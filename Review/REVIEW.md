# Code review

Последний коммит на момент ревью: efff4246284413fc7908d7fd405ea0704ea3ced2

## Работает

- Загружаются настройки.
- Сохраняются настройки.
- При сохранении настроек кнопки переходят в состояние disabled. Производится валидация полей, форма не отправляется, отображается ошибка. Отображается ошибка при неудачном клонировании репозитория.
- Загружаются списки билдов.
- Загружаются страницы с деталями билда при переходе со страницы списка билдов.

## Не работает

- Запуск сервера на системе Windows. Рекомендую использовать пакет cross-env для передачи переменных через командную строку.
- Кнопка очистки input. Также при клике запускает отправку формы.
- Нет кнопки Show more и соответствующей логики на странице списка билдов.
- Кнопка Open settings на главной странице. При клике должна открываться настройки.
- Лог билда загружается с сервера, но отображается фейковый.

## Что нужно исправить

- Удалить из репозитория папки `node_modules` и `hw_0001`.
- Нажатие на кнопку Cancel на странице Settings приводит к отправке формы. По умолчанию все кнопки в внутри тега form имеют тип submit. Нужно назначить этой кнопке тип button. Также логично при нажатии на эту кнопку редиректить на предыдущею страницу, иначе у этой кнопки просто нет никакой функциональности. После успешного сохранения настроек также логично вернуться на страницу с которой они были открыты.
- История билдов по заданию должна отображаться по адресу <http://localhost:3000/>, а не редиректить на страницу /history.
- Добавить правильные стили ссылке в header, они там отсутствуют, поэтому ссылка отображается синяя с подчеркиванием.
- На страницах списка билдов и лога билда в шапке должно отображаться имя репозитория.
- Верстку. Карточки билда на странице с логом не соответствует макету, возможно не хватает какого-либо модификатора в селекторе. Плывет отображение лога в десктоп версии. Проблема со стилями у header на странице лога, в десктоп версии у кнопок остаются только иконки (см. скриншот). Во время загрузки данных footer прилипает к header (см. скриншот). Поле для настройки периода обновления не соответствует макету.
- Не игнорировать ошибки и ворнинг в консоли девтулов, в <React.StrictMode> не просто так обернуто приложение.
- Удалить лишние `console.log` (см. скриншот) и весь закоментированный код.

### Переделать всю работу со Redux Store

- Перенести все сайды эффекты касающиеся запросов в actions раз подключена библиотека `redux-thunk`.
- Логика приложения сильно размазана. Что-то в компонентах, что-то в редакс сторе.
- В экшенах `saveSettingsYndx` и `getSettingsFromYNDX` диспатчится очень много экшенов с разными типами, но `settingsReducers` редьюсит только 1 тип `SAVE_SETTINGS_TO_REDUX`. Нужно добавить все типы экшенов в редьюсер.
- Непонятный диспатч `dispatch({ type: saveSettings, payload: response.data });`, который ничего не делает.
- В экшене `getSettingsFromYNDX` не сохраняются полученные настройки в стор, хотя нужно всего-то задиспатчить `saveSettings` и тогда в компоненте `Myswitch` не придется вызывать `saveSettings`. Тут должен работать принцип единственной ответственности. В `componentDidMount` мы проверяем есть ли в сторе данные по настройкам и если нет, то просто диспатчим экшен на их загрузку, компоненту вообще не нужно знать как эти данные загружаются и сохраняются, он лишь должен обновиться, если данные в сторе изменились.
- Редьюсеры разные, но все экшены свалены в один файл. Например, можно сделать такую структуру:

  ```bash
  store
    builds
      actions.js
      types.js
      reducer.js
    settings
      actions.js
      types.js
      reducer.js
  ```

  Она позволит импортировать в редьюсер только типы, а в компоненты только необходимые экшены.

## Что можно улучшить

### Общее

- Оформить домашку в виде pull request как это рекомендуют в задании, это упростило бы code review.
- Использовать более атомарные коммиты. Сложно понимать как шла разработка. В одном коммите сразу и добавление сервера и правка стилей компонентов.
- Добавить в инструкцию по запуску, как нужно устанавливать зависимости.
- Добавить `npm scripts` для запуска сервера.
- Придерживаться единого оформления с помощью `eslint` и `prettier`.
- Удалить не используемые импорты.
- Использовать более информативные нейминг. `Myswitch` и `mydisabled` не лучшие варианты.
- Во многих компонентах используются атрибут `class`, в React рекомендуется использовать `className`. Можно найти и больше нарушений в консоли девтулз.
- В `package.json` указана библиотека `@bem-react/classname`, но используется всего в нескольких компонентах. Либо убрать её совсем, либо использовать во всех компонентах (рекомендую второе).
- Использовать `Route` бибилиотеки `react-router` только в одном месте приложения(судя по архитектуре это в файле `index.js`). Компонент `Header` от них выглядит слишком перегруженным.
- Использовать функциональные компоненты в React. В лекциях не раз отмечали, что всё новое нужно писать на них и использовать React hooks.
- Выделить из компонентов отдельные страницы, для улучшения архитектуры.
- Выделить компонент `Grid`, используется на 2-х страницах.

### Компонент BuildLog

- Каждая загрузка билд лога загружает верхние 25 билдов и ищет там нужный билд по номеру. При таком API хранилища в качестве `number` для роутинга лучше выбрать `id` билда, а не его номер, тогда не придется делать такие тяжелые операции и запрашивать детали билда напрямую в ручке `GET /api/builds/:buildId` (там кстати со временем может появится больше информации, чем в листе билдов и её нужно будет отображать).
- `document.querySelector('.inner').innerHTML`. Работа с DOM мимо React плохая идея. [Тут описано](https://ru.reactjs.org/docs/dom-elements.html#dangerouslysetinnerhtml) как нужно вставлять свой html код.
- непонятно зачем вызывается `saveCurrentBuildToRedux`, никакие данные из стора не извлекаются и весь стейт хранится в компоненте.

### Компонент BuildHistory

- Не используется редакс стор, хотя мапинг в пропсы есть `connect(mapStateToProps,mapsDispatchToProps)(BuildHistory)`.
- Загружаюся билды и сохраняются как в стейт компонента так и в редакс стор. В этом случае не нужно хранить хранить данные в стейте, они уже есть в `this.props.builds`.

### Компонент Card

- `handleCardClick` жестко привязывает поведение карточки при клике и в итоге на странице лога билда при клике на карточку бесконечно пушит в историю. Тут лучше прокидывать в карточку через пропс 2 параметра `href` и `onClick`. Так мы может задавать любое поведение на клик плюс при наличии `href` пушить в историю. Пример:

  ```javascript
  handleCardClick = (e) => {
    this.props.onClick && this.props.onClick(e);
    if (this.props.href) {
      history.push(this.props.href);
    }
  };
  ```

- Много повторяющихся кусков кода. Кажется нужно вынести в компоненты `Meta` и `IconContent`, но это не точно :)

### Компонент Header

- Как писалось выше слишком тяжелый компонент. Какие кнопки должны в нем отображаться должен решать родительский компонент(например это может быть компонент страницы), а сам компонент `Header` должен лишь уметь правильно их расположить и добавить им при необходимости правильные миксы. Рекомендую прочитать [вот это раздел](https://ru.reactjs.org/docs/thinking-in-react.html) в официальной документации React, там есть полезные примеры кода. В идеале кнопки передавать через `children`.

### Компонент LinkButton

- Убрать двойную проверку на наличие `this.props.clickHandle`

### Компонент RunBuild

- Добавить тег `form`. Это же всё таки форма.
- Нет обработки ошибок, просто валятся ошибки в консоль.
- Кнопка Cancel выполняет `history.goBack();` хотя должна лишь закрывать модальное окно.
- Метод `handleChange` не используется и его можно удалить.
- Такие компоненты рекомендуют делать через [Порталы](https://ru.reactjs.org/docs/portals.html), чтобы не писать с нуля можно возспользоваться библиотекой [react-modal](https://github.com/reactjs/react-modal).

### Компонент Settings

- Кажется, что функция `mapSettings` ухудшает читабельность компонента и лучше напрямую заполнить 4 `InputGroup`
- При наборе текста в инпутах ререндерится вся страница. Тут можно взглянуть на библиотеку [React Hook Form](https://react-hook-form.com/)
